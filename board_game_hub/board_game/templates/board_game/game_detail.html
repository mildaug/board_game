{% extends 'base.html' %}
{% load static %}

{% block title %} About game {% endblock title %}

{% block content %}
    <h1>About game <a href="{% url 'game_borrow_request' game.id %}">Borrow</a></h1>
    {% if game.image %}
        <img class="game-photo" src="{{ game.image.url }}" alt="Game Photo">
    {% else %}
        <span>No Image Available</span>
    {% endif %}
    <p><strong>Title:</strong> {{ game.title }}</p>
    <p><strong>Publisher:</strong> {{ game.publisher }}</p>
    <p><strong>Year:</strong> {{ game.year }}</p>
    <p><strong>Category(-ies):</strong> {% for game_category in game.category.all %}{{ game_category.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
    <p><strong>Difficulty:</strong> {{ game.difficulty }}</p>
    <p><strong>Player count:</strong> {{ game.player_count }}</p>
    <p><strong>Duration:</strong> {{ game.duration }}</p>
    <p><strong>Player age:</strong> {{ game.player_age }}</p>
    <p><strong>Language:</strong> {{ game.language }}</p>
    <p><strong>Owner:</strong> {{ game.owner }}</p>

    <h2>Average Rating: {{ average_rating }}</h2>

    <h2>User Ratings and Comments:</h2>
    <ul>
        {% for rating in ratings %}
        <li>
            <strong>User: {{ rating.user }}</strong>
            <br>
            Rating: {{ rating.rating }}
            <br>
            Comment: {{ rating.comment }}
        </li>
        {% empty %}
            <li>No ratings or comments available.</li>
        {% endfor %}
    </ul>

    {% if not user_rated %}
        <h3>Submit Your Rating and Comment:</h3>
        <form method="POST" action="{% url 'game_detail' game.pk %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Submit</button>
        </form>
    {% else %}
        <p>You have already rated and left a review for this game.</p>
    {% endif %}

    {% if game.video_url %}
    <h2>Video:</h2>
    <div id="player"></div>

    <script src="https://www.youtube.com/player_api"></script>
    <script>
        function getYouTubeVideoId(url) {
            var match = url.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([A-Za-z0-9_\-]+)/);
            return match ? match[1] : null;
        }

        function onYouTubePlayerAPIReady() {
            var videoId = getYouTubeVideoId('{{ game.video_url }}');
            if (videoId) {
                new YT.Player('player', {
                    height: '360',
                    width: '640',
                    videoId: videoId
                });
            }
        }
    </script>
    {% endif %}
{% endblock %}